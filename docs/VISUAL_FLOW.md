# Cloak - Visual System Flow

## ðŸŽ¨ Simplified Architecture Diagram

```
                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚     USER (CLIENT)       â”‚
                                 â”‚   - Wallet (Phantom)    â”‚
                                 â”‚   - Web Browser         â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚                                â”‚
                    DEPOSIT                          WITHDRAW
                         â”‚                                â”‚
                         â–¼                                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  1. Create Commitment      â”‚    â”‚  1. Scan Encrypted Notes     â”‚
        â”‚     C = H(amt,r,pk)        â”‚    â”‚  2. Get Merkle Proof         â”‚
        â”‚  2. Encrypt Output         â”‚    â”‚  3. Generate ZK Proof        â”‚
        â”‚  3. Send to Solana         â”‚    â”‚  4. Submit via Relay         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                                  â”‚
                   â”‚ Transaction                      â”‚ Proof + Outputs
                   â–¼                                  â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    SOLANA BLOCKCHAIN                           â”‚
        â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
        â”‚         â”‚  SHIELD-POOL PROGRAM                 â”‚              â”‚
        â”‚         â”‚  c1oak6tetx...                       â”‚              â”‚
        â”‚         â”‚                                      â”‚              â”‚
        â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚              â”‚
        â”‚         â”‚  â”‚ DEPOSIT  â”‚      â”‚ WITHDRAW â”‚     â”‚              â”‚
        â”‚         â”‚  â”‚  (0% fee)â”‚      â”‚ (0.5% + â”‚     â”‚              â”‚
        â”‚         â”‚  â”‚          â”‚      â”‚  0.0025) â”‚     â”‚              â”‚
        â”‚         â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â”‚              â”‚
        â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚                  â”‚
                Emit Eventâ”‚                  â”‚Verify Proof & Transfer
                          â”‚                  â”‚
                          â–¼                  â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   INDEXER SERVICE       â”‚  â”‚  NULLIFIER SET       â”‚
        â”‚   - Watch Events        â”‚  â”‚  - Track Spent Notes â”‚
        â”‚   - Build Merkle Tree   â”‚  â”‚  - Prevent Doubles   â”‚
        â”‚   - Serve Proofs        â”‚  â”‚                      â”‚
        â”‚   - Store Commitments   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ Store & Update
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   MERKLE TREE           â”‚
        â”‚   31 levels             â”‚
        â”‚   BLAKE3-256            â”‚
        â”‚   2^31 capacity         â”‚
        â”‚                         â”‚
        â”‚   Câ‚ Câ‚‚ Câ‚ƒ Câ‚„ ...      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”„ Deposit Flow (Step by Step)

```
USER                    SOLANA              INDEXER
 â”‚                        â”‚                    â”‚
 â”‚ 1. Generate keys       â”‚                    â”‚
 â”‚    sk, r, pk           â”‚                    â”‚
 â”‚                        â”‚                    â”‚
 â”‚ 2. Compute C           â”‚                    â”‚
 â”‚    C = H(amt,r,pk)     â”‚                    â”‚
 â”‚                        â”‚                    â”‚
 â”‚ 3. Encrypt note        â”‚                    â”‚
 â”‚    enc = E(pk, note)   â”‚                    â”‚
 â”‚                        â”‚                    â”‚
 â”‚ 4. Submit tx â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚
 â”‚    (SOL + C + enc)     â”‚                    â”‚
 â”‚                        â”‚                    â”‚
 â”‚                        â”‚ 5. Validate        â”‚
 â”‚                        â”‚    Transfer SOL    â”‚
 â”‚                        â”‚    Store C         â”‚
 â”‚                        â”‚                    â”‚
 â”‚                        â”‚ 6. Emit Event â”€â”€â”€â”€>â”‚
 â”‚                        â”‚    (C, enc, time)  â”‚
 â”‚                        â”‚                    â”‚
 â”‚                        â”‚                    â”‚ 7. Append to tree
 â”‚                        â”‚                    â”‚    leaf[n] = C
 â”‚                        â”‚                    â”‚
 â”‚                        â”‚                    â”‚ 8. Compute root
 â”‚                        â”‚                    â”‚    root = H(...)
 â”‚                        â”‚                    â”‚
 â”‚ 9. Query root <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚    & proofs            â”‚                    â”‚
 â”‚                        â”‚                    â”‚
```

---

## ðŸ” Withdraw Flow (Step by Step)

```
USER              INDEXER         SP1-PROVER      RELAY         SOLANA
 â”‚                   â”‚                â”‚             â”‚              â”‚
 â”‚ 1. Scan notes     â”‚                â”‚             â”‚              â”‚
 â”‚    Decrypt own    â”‚                â”‚             â”‚              â”‚
 â”‚                   â”‚                â”‚             â”‚              â”‚
 â”‚ 2. Get root â”€â”€â”€â”€â”€>â”‚                â”‚             â”‚              â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚             â”‚              â”‚
 â”‚    root=0xabc     â”‚                â”‚             â”‚              â”‚
 â”‚                   â”‚                â”‚             â”‚              â”‚
 â”‚ 3. Get proof â”€â”€â”€â”€>â”‚                â”‚             â”‚              â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚             â”‚              â”‚
 â”‚    merkle_path    â”‚                â”‚             â”‚              â”‚
 â”‚                   â”‚                â”‚             â”‚              â”‚
 â”‚ 4. Generate proof â”‚                â”‚             â”‚              â”‚
 â”‚   (Private inputs)â”‚                â”‚             â”‚              â”‚
 â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚              â”‚
 â”‚   - amount, r, sk                  â”‚             â”‚              â”‚
 â”‚   - leaf_index                     â”‚             â”‚              â”‚
 â”‚   - merkle_path                    â”‚             â”‚              â”‚
 â”‚                   â”‚                â”‚             â”‚              â”‚
 â”‚                   â”‚            5. Run circuit   â”‚              â”‚
 â”‚                   â”‚               - Verify path  â”‚              â”‚
 â”‚                   â”‚               - Compute nf   â”‚              â”‚
 â”‚                   â”‚               - Check cons   â”‚              â”‚
 â”‚                   â”‚                â”‚             â”‚              â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚             â”‚              â”‚
 â”‚   proof (260B)    â”‚                â”‚             â”‚              â”‚
 â”‚                   â”‚                â”‚             â”‚              â”‚
 â”‚ 6. Submit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚
 â”‚   (proof, pub_in, â”‚                â”‚             â”‚              â”‚
 â”‚    outputs)       â”‚                â”‚             â”‚              â”‚
 â”‚                   â”‚                â”‚             â”‚              â”‚
 â”‚                   â”‚                â”‚         7. Validate        â”‚
 â”‚                   â”‚                â”‚            Check nf        â”‚
 â”‚                   â”‚                â”‚            Build tx        â”‚
 â”‚                   â”‚                â”‚             â”‚              â”‚
 â”‚                   â”‚                â”‚         8. Submit â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                   â”‚                â”‚             â”‚              â”‚
 â”‚                   â”‚                â”‚             â”‚          9. Verify
 â”‚                   â”‚                â”‚             â”‚             - Root
 â”‚                   â”‚                â”‚             â”‚             - Nf
 â”‚                   â”‚                â”‚             â”‚             - Proof
 â”‚                   â”‚                â”‚             â”‚             - Outputs
 â”‚                   â”‚                â”‚             â”‚
 â”‚                   â”‚                â”‚             â”‚         10. Execute
 â”‚                   â”‚                â”‚             â”‚             - Mark nf
 â”‚                   â”‚                â”‚             â”‚             - Transfer
 â”‚                   â”‚                â”‚             â”‚             - Pay fee
 â”‚                   â”‚                â”‚             â”‚              â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚   SOL received!   â”‚                â”‚             â”‚              â”‚
 â”‚                   â”‚                â”‚             â”‚              â”‚
```

---

## ðŸ” Zero-Knowledge Proof Circuit

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SP1 ZK CIRCUIT                               â”‚
â”‚                                                                â”‚
â”‚  PRIVATE INPUTS (Witness):                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â€¢ amount: 1.0 SOL                                        â”‚ â”‚
â”‚  â”‚ â€¢ r: 0x7f3a... (32 bytes randomness)                     â”‚ â”‚
â”‚  â”‚ â€¢ sk_spend: 0x9b2c... (32 bytes secret)                  â”‚ â”‚
â”‚  â”‚ â€¢ leaf_index: 42                                         â”‚ â”‚
â”‚  â”‚ â€¢ merkle_path: [hâ‚, hâ‚‚, ..., hâ‚ƒâ‚] + [0,1,0,...]        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  PUBLIC INPUTS:                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â€¢ root: 0xabc... (32 bytes)                              â”‚ â”‚
â”‚  â”‚ â€¢ nf: 0xdef... (32 bytes nullifier)                      â”‚ â”‚
â”‚  â”‚ â€¢ outputs_hash: 0x123... (32 bytes)                      â”‚ â”‚
â”‚  â”‚ â€¢ amount: 1.0 SOL                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  CONSTRAINTS:                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  1ï¸âƒ£  pk_spend = H(sk_spend)                             â”‚ â”‚
â”‚  â”‚      â”œâ”€ Proves knowledge of secret                      â”‚ â”‚
â”‚  â”‚      â””â”€ Output: 0x4d8f...                                â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  2ï¸âƒ£  C = H(amount || r || pk_spend)                     â”‚ â”‚
â”‚  â”‚      â”œâ”€ Reconstructs commitment                         â”‚ â”‚
â”‚  â”‚      â””â”€ Output: 0x8a7c...                                â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  3ï¸âƒ£  MerkleVerify(C, path) == root                      â”‚ â”‚
â”‚  â”‚      â”œâ”€ Hash(C, hâ‚) = nâ‚                                â”‚ â”‚
â”‚  â”‚      â”œâ”€ Hash(nâ‚, hâ‚‚) = nâ‚‚                               â”‚ â”‚
â”‚  â”‚      â”œâ”€ ... (31 levels)                                 â”‚ â”‚
â”‚  â”‚      â””â”€ Hash(nâ‚ƒâ‚€, hâ‚ƒâ‚) == root âœ“                        â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  4ï¸âƒ£  nf = H(sk_spend || leaf_index)                     â”‚ â”‚
â”‚  â”‚      â”œâ”€ Computes unique nullifier                       â”‚ â”‚
â”‚  â”‚      â””â”€ Output: 0xdef... âœ“                               â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  5ï¸âƒ£  sum(outputs) + fee == amount                       â”‚ â”‚
â”‚  â”‚      â”œâ”€ fee = (1.0 Ã— 0.005) + 0.0025 = 0.0075          â”‚ â”‚
â”‚  â”‚      â”œâ”€ outputs = [0.9925 SOL to Bob]                  â”‚ â”‚
â”‚  â”‚      â””â”€ 0.9925 + 0.0075 = 1.0 âœ“                         â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  6ï¸âƒ£  H(serialize(outputs)) == outputs_hash              â”‚ â”‚
â”‚  â”‚      â”œâ”€ Serialize: Bob_addr || 992500000               â”‚ â”‚
â”‚  â”‚      â””â”€ Hash == 0x123... âœ“                              â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  ALL CONSTRAINTS SATISFIED âœ“                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  OUTPUT:                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Groth16 Proof: 260 bytes                                 â”‚ â”‚
â”‚  â”‚ [0x1a, 0x2b, 0x3c, ...]                                  â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚ Verification: Anyone can verify proof proves:           â”‚ â”‚
â”‚  â”‚ "I know a valid note in the tree with this root,        â”‚ â”‚
â”‚  â”‚  here's its nullifier, and outputs are correct"         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ—‚ï¸ Data Structures

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NOTE (Private Data)                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  struct Note {                                               â”‚
â”‚      amount: u64,           // 1_000_000_000 (1 SOL)        â”‚
â”‚      r: [u8; 32],          // Random blinding factor        â”‚
â”‚      sk_spend: [u8; 32],   // Secret spending key           â”‚
â”‚      leaf_index: u32,      // Position in tree (42)         â”‚
â”‚  }                                                           â”‚
â”‚                                                              â”‚
â”‚  Stored encrypted on-chain, decrypted by recipient         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  COMMITMENT (Public)                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  C = BLAKE3(amount || r || pk_spend)                        â”‚
â”‚    = BLAKE3(1.0 SOL || 0x7f3a... || 0x4d8f...)             â”‚
â”‚    = 0x8a7c...                                              â”‚
â”‚                                                              â”‚
â”‚  Stored in Merkle tree, visible on-chain                    â”‚
â”‚  Hides: amount, recipient, spending authority               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NULLIFIER (Prevents Double-Spend)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  nf = BLAKE3(sk_spend || leaf_index)                        â”‚
â”‚     = BLAKE3(0x9b2c... || 42)                               â”‚
â”‚     = 0xdef...                                              â”‚
â”‚                                                              â”‚
â”‚  Revealed when spending, stored on-chain                    â”‚
â”‚  Links: note â†’ spent status                                 â”‚
â”‚  Hides: commitment, amount, original depositor              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MERKLE TREE (31 Levels)                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Level 31 (Root):        [0xabc...]                         â”‚
â”‚                          /        \                          â”‚
â”‚  Level 30:         [0x123...]  [0x456...]                   â”‚
â”‚                    /      \      /      \                    â”‚
â”‚  Level 29:     [..]  [..]  [..]  [..]                       â”‚
â”‚                 â‹®     â‹®     â‹®     â‹®                         â”‚
â”‚  Level 0:    [Câ‚] [Câ‚‚] [Câ‚ƒ] [Câ‚„] [Câ‚…] ...                  â”‚
â”‚              (Commitments)                                   â”‚
â”‚                                                              â”‚
â”‚  Proof for Câ‚ƒ (leaf_index=2):                               â”‚
â”‚  pathElements = [Câ‚„, H(Câ‚,Câ‚‚), ..., hâ‚ƒâ‚]                   â”‚
â”‚  pathIndices = [1, 0, 1, 0, ...]  (left=0, right=1)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ’° Fee Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DEPOSIT FEES                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Protocol Fee:    0% (FREE)                                â”‚
â”‚  Network Fee:     ~0.000005 SOL                            â”‚
â”‚  Total Cost:      ~0.000005 SOL                            â”‚
â”‚                                                            â”‚
â”‚  Example: Deposit 1.0 SOL                                 â”‚
â”‚  â”œâ”€ User pays: 1.000005 SOL                               â”‚
â”‚  â””â”€ Pool receives: 1.0 SOL                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WITHDRAWAL FEES                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Variable Fee:    0.5% of amount                           â”‚
â”‚  Fixed Fee:       0.0025 SOL                               â”‚
â”‚  Network Fee:     ~0.000005 SOL                            â”‚
â”‚                                                            â”‚
â”‚  Example: Withdraw 1.0 SOL                                â”‚
â”‚  â”œâ”€ Variable: 1.0 Ã— 0.005 = 0.0050 SOL                    â”‚
â”‚  â”œâ”€ Fixed: 0.0025 SOL                                     â”‚
â”‚  â”œâ”€ Total protocol fee: 0.0075 SOL                        â”‚
â”‚  â”œâ”€ Network fee: 0.000005 SOL                             â”‚
â”‚  â””â”€ Recipient gets: 0.992495 SOL                          â”‚
â”‚                                                            â”‚
â”‚  Fee Distribution:                                         â”‚
â”‚  â””â”€ 100% to treasury (future: can split with relayers)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”’ Security Properties Summary

```
âœ… PRIVACY
  â”œâ”€ Deposit address â‰  Withdraw address
  â”œâ”€ Amount hidden in commitment
  â”œâ”€ Recipient hidden in commitment
  â””â”€ Timing can be decorrelated via delays

âœ… SECURITY
  â”œâ”€ Double-spend prevented by nullifiers
  â”œâ”€ Counterfeit prevented by Merkle proofs
  â”œâ”€ Front-running prevented (nf tied to sk)
  â””â”€ Conservation enforced in circuit

âš ï¸  KNOWN LIMITATIONS
  â”œâ”€ Output amounts visible on-chain (MVP)
  â”œâ”€ Timing analysis possible
  â”œâ”€ Requires trust in SP1 proving system
  â””â”€ Admin role for root updates (can be decentralized)

ðŸ”§ FUTURE ENHANCEMENTS
  â”œâ”€ Fixed denominations for better privacy
  â”œâ”€ Stealth addresses
  â”œâ”€ Decentralized root updates
  â””â”€ Multi-token support
```

---

## ðŸ“Š System Status

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PRODUCTION STATUS                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  âœ… Solana Program          DEPLOYED                       â”‚
â”‚     â””â”€ c1oak6tetxYnNfvXKFkpn1d98FxtK7B68vBQLYQpWKp       â”‚
â”‚                                                            â”‚
â”‚  âœ… SP1 Circuit             WORKING                        â”‚
â”‚     â””â”€ Proof generation: 30-60s                           â”‚
â”‚                                                            â”‚
â”‚  âœ… Indexer Service         OPERATIONAL                    â”‚
â”‚     â””â”€ Merkle tree + API endpoints                        â”‚
â”‚                                                            â”‚
â”‚  âœ… Relay Service           OPERATIONAL                    â”‚
â”‚     â””â”€ Transaction submission + tracking                  â”‚
â”‚                                                            â”‚
â”‚  ðŸš§ Web Frontend            IN DEVELOPMENT                 â”‚
â”‚     â””â”€ UI + WASM prover integration                       â”‚
â”‚                                                            â”‚
â”‚  âœ… Complete Flow Test      PASSING                        â”‚
â”‚     â””â”€ Localnet + Testnet                                 â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


